<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guia Interativo para Escrever Livros</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
            height: 350px;
            max-height: 400px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 400px;
            }
        }
        .nav-link {
            transition: background-color 0.2s, color 0.2s, border-color 0.2s;
        }
        .nav-link.active {
            background-color: #57534e;
            color: #f5f5f4;
            border-color: #57534e;
        }
        .nav-link:not(.active):hover {
            background-color: #d6d3d1;
            color: #57534e;
        }
    </style>
</head>
<body class="font-sans bg-stone-100 text-stone-700 antialiased">

    <div class="container mx-auto max-w-7xl p-4 md:p-8">
        
        <!-- Cabeçalho -->
        <header class="mb-8">
            <h1 class="text-4xl md:text-5xl font-bold text-stone-800 text-center mb-2">Guia Interativo para Escrever Seu Livro</h1>
            <p class="text-lg text-stone-600 text-center max-w-3xl mx-auto">Uma ferramenta para navegar pelas etapas da concepção à publicação.</p>
        </header>

        <!-- Estrutura Principal: Navegação + Conteúdo -->
        <div class="flex flex-col md:flex-row gap-8">

            <!-- Navegação Lateral/Abas -->
            <nav class="md:w-1/4">
                <ul class="flex flex-row md:flex-col overflow-x-auto md:overflow-x-visible space-x-2 md:space-x-0 md:space-y-2">
                    <li>
                        <button class="nav-link active w-full text-left py-3 px-4 rounded-lg font-semibold border border-stone-300 bg-white" data-target="content-overview">
                            Visão Geral
                        </button>
                    </li>
                    <li>
                        <button class="nav-link w-full text-left py-3 px-4 rounded-lg font-semibold border border-stone-300 bg-white" data-target="content-fase1">
                            Fase 1: Planejamento
                        </button>
                    </li>
                    <li>
                        <button class="nav-link w-full text-left py-3 px-4 rounded-lg font-semibold border border-stone-300 bg-white" data-target="content-fase2">
                            Fase 2: 1º Rascunho
                        </button>
                    </li>
                    <li>
                        <button class="nav-link w-full text-left py-3 px-4 rounded-lg font-semibold border border-stone-300 bg-white" data-target="content-fase3">
                            Fase 3: Revisão
                        </button>
                    </li>
                    <li>
                        <button class="nav-link w-full text-left py-3 px-4 rounded-lg font-semibold border border-stone-300 bg-white" data-target="content-fase4">
                            Fase 4: Finalização
                        </button>
                    </li>
                </ul>
            </nav>

            <!-- Painel de Conteúdo -->
            <main class="md:w-3/4">
                
                <!-- CONTEÚDO: Visão Geral -->
                <section class="content-panel active" id="content-overview">
                    <div class="bg-white p-6 md:p-8 rounded-lg shadow-lg">
                        <h2 class="text-3xl font-bold text-stone-800 mb-4">Visão Geral das Fases</h2>
                        <p class="text-lg text-stone-600 mb-6">
                            Escrever um livro é um processo que equilibra diferentes habilidades ao longo do tempo. Algumas fases exigem mais criatividade pura, enquanto outras demandam mais esforço analítico e disciplina. Este gráfico compara o foco principal de cada fase.
                        </p>
                        <div class="chart-container">
                            <canvas id="phaseFocusChart"></canvas>
                        </div>
                        <p class="text-sm text-stone-500 text-center mt-4">
                            Use este gráfico para entender onde sua energia será mais necessária em cada etapa da jornada.
                        </p>
                    </div>
                </section>

                <!-- CONTEÚDO: Fase 1 -->
                <section class="content-panel hidden" id="content-fase1">
                    <div class="bg-white p-6 md:p-8 rounded-lg shadow-lg">
                        <h2 class="text-3xl font-bold text-stone-800 mb-4">FASE 1: Planejamento e Estrutura</h2>
                        <p class="text-lg text-stone-600 mb-6">
                            Esta é a fundação do seu livro. Não pule esta etapa, pois ela economizará tempo e evitará bloqueios criativos mais tarde.
                        </p>

                        <div class="space-y-6">
                            <div>
                                <h3 class="text-xl font-semibold text-stone-700 mb-2">1. Defina a Ideia Central e o Gênero</h3>
                                <ul class="list-disc list-outside pl-5 space-y-2 text-stone-600">
                                    <li><strong class="text-stone-700">A "Centelha":</strong> Qual é a premissa única da sua história? Se for não-ficção, qual é a tese principal?</li>
                                    <li><strong class="text-stone-700">Gênero:</strong> Determine o gênero (Ficção Científica, Romance, Autoajuda, etc.) para definir as expectativas do leitor.</li>
                                    <li><strong class="text-stone-700">Público-Alvo:</strong> Para quem você está escrevendo? Isso define a linguagem, o ritmo e os temas.</li>
                                </ul>
                            </div>

                            <div>
                                <h3 class="text-xl font-semibold text-stone-700 mb-2">2. Desenho de Personagens e Cenários</h3>
                                <ul class="list-disc list-outside pl-5 space-y-2 text-stone-600">
                                    <li><strong class="text-stone-700">Personagens Principais:</strong> Crie fichas detalhadas (motivações, medos, falhas, objetivos).</li>
                                    <li><strong class="text-stone-700">Arco do Personagem:</strong> Como o protagonista mudará da primeira à última página?</li>
                                    <li><strong class="text-stone-700">Construção de Mundo:</strong> Descreva os cenários principais e estabeleça as regras do seu mundo.</li>
                                </ul>
                            </div>

                            <div>
                                <h3 class="text-xl font-semibold text-stone-700 mb-2">3. O Esboço (Outline)</h3>
                                <p class="text-stone-600 mb-4">Crie um mapa para evitar que você se perca. Liste os eventos principais ou tópicos por capítulo.</p>
                                
                                <h4 class="text-lg font-semibold text-stone-700 mt-4 mb-3">Exemplo: Estrutura de Três Atos (Ficção)</h4>
                                <div class="flex flex-col md:flex-row justify-center items-center gap-2 md:gap-4 p-4 bg-stone-50 rounded-lg border border-stone-200">
                                    <div class="p-4 bg-white rounded-lg shadow-sm border border-stone-300 text-center w-full md:w-auto">
                                        <h5 class="font-bold text-stone-700">Ato I: Início</h5>
                                        <p class="text-sm text-stone-600">Apresentação, Ponto de Virada 1</p>
                                    </div>
                                    <div class="text-2xl font-bold text-stone-400 transform md:rotate-0 rotate-90">&rarr;</div>
                                    <div class="p-4 bg-white rounded-lg shadow-sm border border-stone-300 text-center w-full md:w-auto">
                                        <h5 class="font-bold text-stone-700">Ato II: Conflito</h5>
                                        <p class="text-sm text-stone-600">Obstáculos, Clímax Intermediário</p>
                                    </div>
                                    <div class="text-2xl font-bold text-stone-400 transform md:rotate-0 rotate-90">&rarr;</div>
                                    <div class="p-4 bg-white rounded-lg shadow-sm border border-stone-300 text-center w-full md:w-auto">
                                        <h5 class="font-bold text-stone-700">Ato III: Resolução</h5>
                                        <p class="text-sm text-stone-600">Clímax Final, Desfecho</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- NOVO RECURSO GEMINI: Gerador de Premissas -->
                        <div class="mt-8 pt-6 border-t border-stone-200">
                            <h3 class="text-2xl font-bold text-stone-800 mb-4 flex items-center">
                                Gerador de Premissas e Ideias ✨
                            </h3>
                            <p class="text-stone-600 mb-4">
                                Use a IA para transformar um conceito vago em 3 a 5 ideias de premissas atraentes.
                            </p>

                            <div class="bg-stone-50 p-4 rounded-lg space-y-3">
                                <div>
                                    <label for="input-genre" class="block text-sm font-medium text-stone-700">Gênero (Ex: Ficção Científica, Thriller)</label>
                                    <input type="text" id="input-genre" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border" placeholder="Fantasia Épica">
                                </div>
                                <div>
                                    <label for="input-theme" class="block text-sm font-medium text-stone-700">Tema Principal (Ex: Redenção, Inteligência Artificial)</label>
                                    <input type="text" id="input-theme" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border" placeholder="Viagem no Tempo">
                                </div>
                                <div>
                                    <label for="input-protagonist" class="block text-sm font-medium text-stone-700">Tipo de Protagonista (Ex: Jovem Orfão, Detetive Cínico)</label>
                                    <input type="text" id="input-protagonist" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border" placeholder="Um gato falante">
                                </div>
                                
                                <button id="generate-premises-btn" class="w-full bg-stone-700 hover:bg-stone-800 text-white font-bold py-2 px-4 rounded-lg transition duration-150 shadow-md">
                                    Gerar Ideias de Livros ✨
                                </button>
                            </div>

                            <div id="loading-indicator" class="hidden mt-4 p-3 bg-yellow-100 border border-yellow-300 text-yellow-800 rounded-lg text-center">
                                Gerando ideias criativas... por favor, aguarde.
                            </div>

                            <div id="premises-results" class="mt-4 space-y-4">
                                <!-- Resultados aparecerão aqui -->
                            </div>
                        </div>

                    </div>
                </section>

                <!-- CONTEÚDO: Fase 2 -->
                <section class="content-panel hidden" id="content-fase2">
                    <div class="bg-white p-6 md:p-8 rounded-lg shadow-lg">
                        <h2 class="text-3xl font-bold text-stone-800 mb-4">FASE 2: A Escrita do Primeiro Rascunho</h2>
                        <p class="text-lg text-stone-600 mb-6">
                            Esta é a fase de pura criação. A regra de ouro aqui é: <strong class="text-stone-900">Escreva, Não Edite.</strong> O objetivo é terminar.
                        </p>

                        <div class="space-y-6">
                            <div>
                                <h3 class="text-xl font-semibold text-stone-700 mb-2">1. Estabeleça uma Rotina de Escrita</h3>
                                <ul class="list-disc list-outside pl-5 space-y-2 text-stone-600">
                                    <li><strong class="text-stone-700">Metas Diárias:</strong> Defina uma meta de palavras ou tempo (ex: 500 palavras ou 1 hora). A consistência é mais importante que a intensidade.</li>
                                    <li><strong class="text-stone-700">Encontre seu Lugar:</strong> Escolha um local e um horário dedicados para escrever.</li>
                                    <li><strong class="text-stone-700">Desligue o Crítico Interno:</strong> Permita-se escrever mal. O primeiro rascunho é onde você conta a história para si mesmo.</li>
                                </ul>
                            </div>

                            <div>
                                <h3 class="text-xl font-semibold text-stone-700 mb-2">2. Siga o Fluxo</h3>
                                <ul class="list-disc list-outside pl-5 space-y-2 text-stone-600">
                                    <li><strong class="text-stone-700">Ignore Buracos na Trama:</strong> Se travar, deixe uma nota (ex: `[RESOLVER DEPOIS]`) e siga em frente.</li>
                                    <li><strong class="text-stone-700">Mantenha o Ritmo:</strong> Tente escrever cada capítulo do início ao fim sem voltar para polir frases.</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- CONTEÚDO: Fase 3 -->
                <section class="content-panel hidden" id="content-fase3">
                    <div class="bg-white p-6 md:p-8 rounded-lg shadow-lg">
                        <h2 class="text-3xl font-bold text-stone-800 mb-4">FASE 3: Revisão, Edição e Polimento</h2>
                        <p class="text-lg text-stone-600 mb-6">
                            Parabéns! Você tem o primeiro rascunho. Agora, o trabalho de verdade começa.
                        </p>

                        <div class="space-y-6">
                            <div>
                                <h3 class="text-xl font-semibold text-stone-700 mb-2">1. O Distanciamento (A Fase de Repouso)</h3>
                                <ul class="list-disc list-outside pl-5 space-y-2 text-stone-600">
                                    <li><strong class="text-stone-700">Afaste-se:</strong> Coloque o manuscrito de lado por duas a quatro semanas. Isso permite que você volte ao texto com olhos frescos.</li>
                                </ul>
                            </div>

                            <div>
                                <h3 class="text-xl font-semibold text-stone-700 mb-2">2. Revisão Estrutural (A Grande Revisão)</h3>
                                <ul class="list-disc list-outside pl-5 space-y-2 text-stone-600">
                                    <li><strong class="text-stone-700">Leia Como um Leitor:</strong> Concentre-se nas questões macro. O ritmo funciona? A motivação é clara? O final é satisfatório?</li>
                                    <li><strong class="text-stone-700">Grandes Cortes/Reescritas:</strong> Seja implacável. É comum ter que cortar capítulos inteiros ou reorganizar seções.</li>
                                </ul>
                            </div>

                            <div>
                                <h3 class="text-xl font-semibold text-stone-700 mb-2">3. Edição de Linha e Copidesque</h3>
                                <ul class="list-disc list-outside pl-5 space-y-2 text-stone-600">
                                    <li><strong class="text-stone-700">Clareza e Voz:</strong> Concentre-se nas frases. As palavras escolhidas transmitem o significado exato?</li>
                                    <li><strong class="text-stone-700">Gramática e Ortografia:</strong> Corrija erros gramaticais, de pontuação e ortográficos.</li>
                                </ul>
                            </div>

                            <div>
                                <h3 class="text-xl font-semibold text-stone-700 mb-2">4. Beta Readers e Revisores Profissionais</h3>
                                <ul class="list-disc list-outside pl-5 space-y-2 text-stone-600">
                                    <li><strong class="text-stone-700">Beta Readers:</strong> Peça a leitores de confiança para identificarem falhas que você não consegue ver.</li>
                                    <li><strong class="text-stone-700">Revisor Profissional:</strong> Se o objetivo for publicar, o investimento em um profissional é crucial.</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- CONTEÚDO: Fase 4 -->
                <section class="content-panel hidden" id="content-fase4">
                    <div class="bg-white p-6 md:p-8 rounded-lg shadow-lg">
                        <h2 class="text-3xl font-bold text-stone-800 mb-4">FASE 4: Finalização</h2>
                        <p class="text-lg text-stone-600 mb-6">
                            Você está quase lá! Esta fase prepara seu manuscrito polido para o mundo.
                        </p>

                        <div class="space-y-6">
                            <div>
                                <h3 class="text-xl font-semibold text-stone-700 mb-2">1. Título Final</h3>
                                <ul class="list-disc list-outside pl-5 space-y-2 text-stone-600">
                                    <li>Garanta que o título seja atraente e represente o conteúdo.</li>
                                </ul>
                            </div>
                            
                            <div>
                                <h3 class="text-xl font-semibold text-stone-700 mb-2">2. Sinopse / Texto de Contracapa</h3>
                                <ul class="list-disc list-outside pl-5 space-y-2 text-stone-600">
                                    <li>Escreva um resumo conciso e instigante que será usado para a divulgação.</li>
                                </ul>
                            </div>

                            <div>
                                <h3 class="text-xl font-semibold text-stone-700 mb-2">3. O Caminho da Publicação</h3>
                                <ul class="list-disc list-outside pl-5 space-y-2 text-stone-600">
                                    <li>Decida se você buscará uma editora (Publicação Tradicional) ou se publicará por conta própria (Publicação Independente).</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </section>

            </main>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            
            // Lógica de Navegação por Abas
            const navLinks = document.querySelectorAll('.nav-link');
            const contentPanels = document.querySelectorAll('.content-panel');

            navLinks.forEach(link => {
                link.addEventListener('click', () => {
                    const targetId = link.getAttribute('data-target');

                    navLinks.forEach(nav => nav.classList.remove('active'));
                    link.classList.add('active');

                    contentPanels.forEach(panel => {
                        if (panel.id === targetId) {
                            panel.classList.remove('hidden');
                        } else {
                            panel.classList.add('hidden');
                        }
                    });
                });
            });

            // Lógica do Gráfico (Chart.js)
            const ctx = document.getElementById('phaseFocusChart').getContext('2d');
            
            const data = {
                labels: ['Esforço Analítico', 'Tempo Gasto', 'Criatividade Pura', 'Disciplina'],
                datasets: [
                    {
                        label: 'Fase 1: Planejamento',
                        data: [8, 4, 9, 6],
                        fill: true,
                        backgroundColor: 'rgba(87, 83, 78, 0.2)',
                        borderColor: 'rgb(87, 83, 78)',
                        pointBackgroundColor: 'rgb(87, 83, 78)',
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: 'rgb(87, 83, 78)'
                    },
                    {
                        label: 'Fase 2: 1º Rascunho',
                        data: [3, 9, 10, 8],
                        fill: true,
                        backgroundColor: 'rgba(168, 162, 158, 0.2)',
                        borderColor: 'rgb(168, 162, 158)',
                        pointBackgroundColor: 'rgb(168, 162, 158)',
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: 'rgb(168, 162, 158)'
                    },
                    {
                        label: 'Fase 3: Revisão',
                        data: [10, 7, 5, 9],
                        fill: true,
                        backgroundColor: 'rgba(214, 211, 209, 0.2)',
                        borderColor: 'rgb(214, 211, 209)',
                        pointBackgroundColor: 'rgb(214, 211, 209)',
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: 'rgb(214, 211, 209)'
                    }
                ]
            };

            const config = {
                type: 'radar',
                data: data,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    elements: {
                        line: {
                            borderWidth: 3
                        }
                    },
                    scales: {
                        r: {
                            angleLines: {
                                color: '#d6d3d1'
                            },
                            grid: {
                                color: '#d6d3d1'
                            },
                            pointLabels: {
                                font: {
                                    size: 14,
                                    weight: 'bold'
                                },
                                color: '#57534e'
                            },
                            ticks: {
                                backdropColor: '#f5f5f4',
                                color: '#78716c',
                                stepSize: 2
                            },
                            min: 0,
                            max: 10
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                title: function(tooltipItems) {
                                    const item = tooltipItems[0];
                                    let label = item.chart.data.labels[item.dataIndex];
                                    if (Array.isArray(label)) {
                                      return label.join(' ');
                                    } else {
                                      return label;
                                    }
                                }
                            }
                        },
                        legend: {
                            position: 'bottom',
                            labels: {
                                color: '#57534e',
                                font: {
                                    size: 14
                                }
                            }
                        }
                    }
                }
            };

            new Chart(ctx, config);

            // Gemini API Configuration
            const API_KEY = ""; // Kept empty as per instructions
            const MODEL_NAME = 'gemini-2.5-flash-preview-09-2025';
            const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/${MODEL_NAME}:generateContent?key=${API_KEY}`;

            // Utility function for exponential backoff (retry logic)
            async function fetchApi(payload, maxRetries = 5) {
                let lastError = null;
                for (let i = 0; i < maxRetries; i++) {
                    try {
                        const response = await fetch(API_URL, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });

                        if (!response.ok) {
                            // Check if it's a rate limit error (e.g., 429)
                            if (response.status === 429 || response.status >= 500) {
                                throw new Error(`API Error: ${response.status} ${response.statusText}`);
                            }
                            // For other client errors, don't retry, just fail fast
                            const errorJson = await response.json();
                            throw new Error(`API Client Error: ${JSON.stringify(errorJson)}`);
                        }

                        return await response.json();
                    } catch (error) {
                        lastError = error;
                        if (i < maxRetries - 1) {
                            const delay = Math.pow(2, i) * 1000 + Math.random() * 1000;
                            await new Promise(resolve => setTimeout(resolve, delay));
                        }
                    }
                }
                throw new Error("Falha na chamada à API após várias tentativas: " + lastError.message);
            }

            // Main LLM generation function
            async function generatePremises() {
                const genre = document.getElementById('input-genre').value.trim();
                const theme = document.getElementById('input-theme').value.trim();
                const protagonist = document.getElementById('input-protagonist').value.trim();
                const resultsDiv = document.getElementById('premises-results');
                const loadingDiv = document.getElementById('loading-indicator');
                const button = document.getElementById('generate-premises-btn');

                if (!genre && !theme && !protagonist) {
                    resultsDiv.innerHTML = `<p class="text-red-600 p-3 bg-red-100 rounded-lg">Por favor, preencha pelo menos um campo para gerar ideias.</p>`;
                    return;
                }

                button.disabled = true;
                button.classList.add('opacity-50');
                loadingDiv.classList.remove('hidden');
                resultsDiv.innerHTML = '';
                
                const systemPrompt = `Você é um curador de histórias e copywriter criativo de Hollywood. Sua tarefa é criar 5 premissas de livros curtas, instigantes e únicas (loglines) baseadas nos elementos fornecidos pelo usuário. Cada premissa deve ter no máximo duas frases. Formate sua resposta como uma lista numerada concisa.`;
                
                const userQuery = `Gênero: ${genre || 'Não especificado'}. Tema: ${theme || 'Não especificado'}. Protagonista: ${protagonist || 'Não especificado'}. Gere as premissas em Português do Brasil.`;

                const payload = {
                    contents: [{ parts: [{ text: userQuery }] }],
                    systemInstruction: {
                        parts: [{ text: systemPrompt }]
                    },
                    // Using Google Search grounding for fresh, grounded ideas based on real genres/tropes
                    tools: [{ "google_search": {} }]
                };

                try {
                    const response = await fetchApi(payload);
                    const candidate = response.candidates?.[0];

                    if (candidate && candidate.content?.parts?.[0]?.text) {
                        const text = candidate.content.parts[0].text;
                        
                        // Format the output
                        resultsDiv.innerHTML = `
                            <h4 class="text-xl font-semibold text-stone-700 mb-3">Ideias Geradas:</h4>
                            <div class="bg-stone-50 p-4 rounded-lg border border-stone-200 prose prose-stone max-w-none">
                                ${text.split('\n').filter(line => line.trim()).map(line => `<p class="mb-2">${line.replace(/^-/g, '•')}</p>`).join('')}
                            </div>
                        `;

                    } else {
                        resultsDiv.innerHTML = `<p class="text-red-600 p-3 bg-red-100 rounded-lg">Erro ao gerar conteúdo. Tente novamente.</p>`;
                    }
                } catch (error) {
                    resultsDiv.innerHTML = `<p class="text-red-600 p-3 bg-red-100 rounded-lg">Erro na comunicação com a IA: ${error.message}</p>`;
                    console.error('Gemini API Error:', error);
                } finally {
                    loadingDiv.classList.add('hidden');
                    button.disabled = false;
                    button.classList.remove('opacity-50');
                }
            }

            // Event listener for the new button
            document.getElementById('generate-premises-btn').addEventListener('click', generatePremises);
        });
    </script>
</body>
</html>
